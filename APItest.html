<!DOCTYPE html>
<html lang="eng-us">
<head>
    <meta charset="UTF-8">
    <title>Marvel API Test</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>
    <form>
        <input type="text" placeholder = "Search a character" id="character-input">
        <button type="button" id="sub-button">Submit</button>
    </form>
    <h1 id="name-div"></h1>
    <div id="description-div"></div>
    <div id="thumbnail-div"></div>
    <div id="comics-div"></div>

    <table class="table">
        <thead>
            <tr>
              <th scope="col">Cover</th>
              <th scope="col">Title</th>
              <th scope="col">Description</th>
              <th scope="col">Page Count</th>
              <th scope="col">Release Date</th>
            </tr>
        </thead>
        <tbody id="table-body">
            <td><span id="comic-thumb"></span></td>
            <td><span id="comic-title"></span></td>
            <td><span id="comic-desc"></span></td>
            <td><span id="comic-pages"></span></td>
            <td><span id="comic-release"></span></td>
        </tbody>
    </table>

<script>      
    $("#sub-button").on("click", function(event){
        console.log("click received")

        event.preventDefault()

        $("#description-div").empty()
        $("#thumbnail-div").empty()
        $("#name-div").empty()
        $("#comics-div").empty()

        var character = $("#character-input").val().trim()
        var queryUrl = "https://gateway.marvel.com:443/v1/public/characters?name=" + character + "&limit=10&ts=1&apikey=f8f6b1e652ea6b5406fc0494dc8babca&hash=1aaf11cbe07314e2d1ea51a9f6bd342c"


        $.ajax({
            url: queryUrl,
            method: "GET"
        }).then(function(response){
     
        //grab relevant data
            var description = response.data.results[0].description

            var name = response.data.results[0].name

            var thumbnailPath = response.data.results[0].thumbnail.path
            var thumbnailExt = ".jpg"

            console.log(response)
            
        //seperate ajax call to grab relevant comics
            var characterID = response.data.results[0].id
            var comicsUrl = "https://gateway.marvel.com:443/v1/public/characters/" + characterID + "/comics?limit=10&ts=1&apikey=f8f6b1e652ea6b5406fc0494dc8babca&hash=1aaf11cbe07314e2d1ea51a9f6bd342c"
            $.ajax({
                url: comicsUrl,
                method: "GET"
            }).then(function(comicResponse){
            
                  var cover = comicResponse.data.results[0].thumbnail.path + ".jpg"
                  var name = comicResponse.data.results[0].title
                  var desc = comicResponse.data.results[0].description
                  var pageCount = comicResponse.data.results[0].pageCount
                  var release = comicResponse.data.results[0].dates[0].date

                  var coverThumb = $("<img>")
                  coverThumb.attr("src", cover) 
                  $("#comic-thumb").append(coverThumb)
                
                  $("#comic-title").text(name)
                  $("#comic-desc").text(desc)
                  $("#comic-pages").text(pageCount)
                  $("#comic-release").text(release)
              
            })

        //create new displays
            $("#description-div").text(JSON.stringify(description))

            $("#name-div").text(JSON.stringify(name))

            var thumbnail = $("<img>")
            var thumbnailSrc = thumbnailPath + thumbnailExt
            thumbnail.attr("src", thumbnailSrc)
            thumbnail.attr("alt", "character picture")
            
            $("#thumbnail-div").append(thumbnail)
            
        })


    })
</script>
</body>
</html>